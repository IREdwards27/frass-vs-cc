---
title: "Lag Comparison"
author: "Indigo Edwards"
date: "10/18/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r data setup}
ncbg_biomass <- 
  map(
    c(2015:2019,2021),
    function(y){
      temp <- 
        comp_data %>% 
        group_by(site, year) %>% 
        mutate(
          '0' = mean_mass,
          '1' = lead(mean_mass, 1),
          '2' = lead(mean_mass, 2),
          '3' = lead(mean_mass, 3),
          '-1' = lag(mean_mass, 1),
          '-2' = lag(mean_mass, 2),
          '-3' = lag(mean_mass, 3)) %>% 
        filter(year == y, site == 'NC Botanical Garden') %>% 
        ungroup()
      
      temp %>% 
        select('0','1','2','3','-1','-2','-3') %>% 
        map(~lm(temp$meanBiomass ~ .x, data = temp)) %>% 
        map(summary) %>% 
        map('r.squared') %>% 
        bind_cols() %>% 
        pivot_longer(
          cols = '0':'-3',
          names_to = 'lag',
          values_to = 'R2') %>% 
        mutate(
          site = 'NC Botanical Garden',
          year = y,
          lag = as.double(lag),
          .before = 'R2')
    }) %>% bind_rows()

ncbg_fracsurveys <- 
  map(
    c(2015:2019,2021),
    function(y){
      temp <- 
        comp_data %>% 
        group_by(site, year) %>% 
        mutate(
          '0' = mean_mass,
          '1' = lead(mean_mass, 1),
          '2' = lead(mean_mass, 2),
          '3' = lead(mean_mass, 3),
          '-1' = lag(mean_mass, 1),
          '-2' = lag(mean_mass, 2),
          '-3' = lag(mean_mass, 3)) %>% 
        filter(year == y, site == 'NC Botanical Garden') %>% 
        ungroup()
      
      temp %>% 
        select('0','1','2','3','-1','-2','-3') %>% 
        map(~lm(temp$fracSurveys ~ .x, data = temp)) %>% 
        map(summary) %>% 
        map('r.squared') %>% 
        bind_cols() %>% 
        pivot_longer(
          cols = '0':'-3',
          names_to = 'lag',
          values_to = 'R2') %>% 
        mutate(
          site = 'NC Botanical Garden',
          year = y,
          lag = as.double(lag),
          .before = 'R2')
    }) %>% bind_rows()
```

